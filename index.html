<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Indica√ß√µes Tracecom</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', sans-serif;
      background: black;
      background-image: radial-gradient(circle, #FFD70022 1px, transparent 1px);
      background-size: 40px 40px;
      color: white;
      text-align: center;
    }

    .logo {
      width: 350px;
      margin: 30px auto;
    }

    .title {
      font-size: 2em;
      margin-bottom: 20px;
      color: #FFD700;
    }

    .participant-line {
      width: 1000px;
      height: 85px;
      background-color: rgba(255, 255, 255, 0.05);
      margin: 10px auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      border-radius: 8px;
    }

    .participant-line span {
      color: white;
      font-size: 14px;
    }

    .btn {
      background-color: #FFD700;
      color: black;
      border: none;
      padding: 10px 16px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
    }

    .btn:hover {
      background-color: #e6c200;
    }

    #popup, #timelinePopup, #editPopup {
    display: none; /* este valor ser√° alterado para 'flex' via JavaScript ao abrir */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

    .popup-content {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      color: white;
    }

    .popup-content input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #FFD700;
      background-color: transparent;
      color: white;
    }

    .popup-content .btn {
      width: 100%;
      margin-top: 10px;
    }

    .timeline-entry {
      text-align: left;
      background: #292929;
      padding: 8px;
      margin: 5px 0;
      border-radius: 6px;
      font-size: 13px;
    }

    .participant {
  background-color: rgba(255, 255, 255, 0.05); /* fundo escuro transparente */
  border: 1px solid rgba(255, 255, 255, 0.1);   /* borda sutil clara */
  padding: 16px 20px;
  margin: 16px auto;
  border-radius: 8px;
  box-shadow: 0 0 6px rgba(255, 215, 0, 0.1); /* brilho dourado leve */
  transition: 0.3s ease;
  color: white; /* letras brancas */
  max-width: 700px; /* centralizar melhor e evitar que fique espremido */
  text-align: center;
    cursor: pointer;
}
    .participant-line {
  width: 100%;
  max-width: 940px;
  margin: 16px auto;
  background-color: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  padding: 16px 20px;
  border-radius: 8px;
  display: flex;
  flex-direction: row; /* ‚Üê ESSA √â A MUDAN√áA */
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  text-align: left;
}


.participant:hover {
  box-shadow: 0 0 10px rgba(0,0,0,0.15);
}

.participant-header h3 {
  margin: 0;
  font-size: 20px;
  color: #FFD700; /* t√≠tulo dourado */
}

.participant-header small {
  color: #ccc;
  font-size: 13px;
}

.participant-body p {
  margin: 6px 0;
  color: white;
}

.token-line {
  display: flex;
  align-items: center;
  gap: 8px;
}

.token-link {
  color: #007bff;
  text-decoration: none;
  font-weight: bold;
}

.token-link:hover {
  text-decoration: underline;
}

.copiar-btn {
  background-color: #28a745;
  color: white;
  border: none;
  padding: 4px 10px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
}

.copiar-btn:hover {
  background-color: #218838;
}

.botoes-container {
  margin-top: 10px;
  display: flex;
  flex-direction: column; /* ‚Üê empilha os bot√µes verticalmente */
  gap: 10px;
  align-items: flex-end;  /* ‚Üê opcional: alinha os bot√µes √† direita */
}

.botoes-container button {
  padding: 5px 12px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  background-color: #007bff;
  color: white;
}

.botoes-container button:hover {
  background-color: #0056b3;
}
    .botoes-container button:active {
      background-color: #004085;
    }

    @media (max-width: 800px) {
      .participant-line {
        width: 90%;
      }
      .logo {
        width: 250px;
      }
    }   

    .token-link {
  background: #1a1a1a;
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid #FFD700;
  font-size: 14px;
  color: #FFD700;
  text-shadow: 0 0 6px #FFD700aa;
  box-shadow: 0 0 10px #FFD70033;
  transition: 0.3s;
}

.token-link:hover {
  background: #2a2a2a;
  box-shadow: 0 0 14px #FFD70066;
  text-decoration: none;
}
    .copiar-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .copiar-btn:hover {
      background: #218838;
    }

    .copiar-btn:active {
      background: #1e7e34;
    }

    .participant-body {
  margin-top: 10px;
  text-align: left;
}

.token-line {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 10px;
}

.botoes-container {
  margin-top: 12px;
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: flex-start;
}

.popup-content {
  position: relative;
  padding: 20px;
  background: rgb(3, 0, 0);
  border-radius: 10px;
}

.popup-fechar {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  color: red;
  font-weight: bold;
  cursor: pointer;
}       
  </style>
</head>

<body>
  <img src="logo-tracecom.png" class="logo" alt="Logo Tracecom">
  <h1 class="title">Sistema de Indica√ß√µes - Tracecom</h1>

  <div id="participantesContainer"></div>

  <button class="btn" onclick="abrirPopup('popup')">Cadastrar Participante</button>

<div id="popup">
  <div class="popup-content">
    <div class="popup-fechar" onclick="fecharPopup('popup')" style="position: absolute; top: 10px; right: 10px; cursor: pointer; color: red; font-size: 24px;">√ó</div>
    <h3>Novo Participante</h3>
    <input type="text" id="nome" placeholder="Nome Completo">
    <input type="text" id="cpf" placeholder="CPF">
    <input type="text" id="condominio" placeholder="Condom√≠nio, Bloco, Apto.">
    <input type="text" id="desconto" placeholder="Desconto Ativo">
    <button class="btn" onclick="salvarParticipante()">Salvar</button>
  </div>
</div>

  <div id="timelinePopup">
  <div class="popup-content">
    <h3 id="timelineTitulo"></h3>

    <!-- üîΩ Aqui entram as informa√ß√µes do participante -->
    <div id="timelineDados" style="margin-bottom: 10px; font-size: 14px; color: #ccc; text-align: left;">
      <!-- Ser√° preenchido dinamicamente com JavaScript -->
    </div>

    <div id="timelineConteudo"></div>
    <hr>
    <input type="text" id="cliNome" placeholder="Nome Cliente">
    <input type="text" id="cliCond" placeholder="Condom√≠nio, Bloco, Apto.">
    <button class="btn" onclick="salvarAtivacao()">Salvar Ativa√ß√£o (+R$50)</button>
    <button class="btn" onclick="fecharPopup('timelinePopup')">Fechar</button>
  </div>
</div>

  <div id="editPopup">
  <div class="popup-content">
    <div class="popup-fechar" onclick="fecharPopup('editPopup')">√ó</div>
    <h3>Editar Participante</h3>
    <input type="hidden" id="editId">
    <div><input type="text" id="editNome" placeholder="Nome completo" /></div>
    <div><input type="text" id="editCPF" placeholder="CPF" /></div>
    <div><input type="text" id="editCondom√≠nio" placeholder="Condom√≠nio e Bloco/Apto" /></div>
    <div><input type="text" id="editDesconto" placeholder="Desconto" /></div>

    <div id="editTokenDisplay" style="margin-top: 10px;"></div>

    <div style="margin-top: 10px;">
      <button class="btn" onclick="salvarEdicao()">Salvar</button>
      <button class="btn" onclick="fecharPopup('editPopup')">Cancelar</button>
    </div>
  </div>
</div>
  <script>
    let participantes = JSON.parse(localStorage.getItem('participantes')) || [];
    let tokenSelecionado = null;

    function gerarToken(nome) {
      const nomeLimpo = nome.toUpperCase().split(" ");
      let prefixo = nomeLimpo[0].substring(0, 4);
      let sufixo = nomeLimpo.slice(1).map(n => n[0]).join('');
      const aleatorio = Math.floor(100 + Math.random() * 900);
      return (prefixo + sufixo + aleatorio).substring(0, 6).toUpperCase();
    }

    function montarMensagemWhatsApp(nome) {
      return `Ol√°! Gostaria de Contratar o servi√ßo de voc√™s. Estou usando o TOKEN de ativa√ß√£o indicado por ${nome} para obter mais benef√≠cios`;
    }

    function criarLinkWhatsApp(nome) {
      const mensagem = encodeURIComponent(montarMensagemWhatsApp(nome));
      return `https://wa.me/552135000188?text=${mensagem}`;
    }

    function renderizarParticipantes() {
  const container = document.getElementById("participantesContainer");
  container.innerHTML = "";

  participantes.forEach((participant, index) => {
    const div = document.createElement("div");
    div.classList.add("participant");

    div.innerHTML = `
  <h3>${participant.nome}</h3>
<small>Token: 
  <a href="https://tracepromotion.github.io/indicacaotracecom?token=${participant.token}&nome=${encodeURIComponent(participant.nome)}" target="_blank" class="token-link">${participant.token}</a>
<button onclick="copiarTokenLink('https://tracepromotion.github.io/indicacaotracecom?token=${participant.token}&nome=${encodeURIComponent(participant.nome)}')" class="copiar-btn">Copiar</button>
</small>


  <div class="stat-box"><strong>Condom√≠nio:</strong><br>${participant.condominio}</div>
  <div class="stat-box"><strong>Ativa√ß√µes:</strong><br>${(participant.timeline && participant.timeline.length) || 0}</div>
  <div class="stat-box"><strong>Cliques:</strong><br>${participant.cliques || 0}</div>

  <div class="botoes-container">
  <button onclick="event.stopPropagation(); abrirTimeline('${participant.token}')">Timeline</button>
  <button type="button" onclick="editarParticipante(event, '${participant.token}')">Editar</button>
  <button onclick="event.stopPropagation(); confirmarExclusao(${index})">Excluir</button>
</div>
`;
div.onclick = () => {
          p.clicks = (p.clicks || 0) + 1;
          localStorage.setItem('participantes', JSON.stringify(participantes));
          renderizarParticipantes();
          window.open(p.link, '_blank');
        };
    const tokenHTML = `
      <div class="token-line">
        <a href="${participant.link}" target="_blank" class="token-link">${participant.token}</a>
        <button class="copiar-btn" onclick="copiarToken('${participant.token}')">Copiar</button>
      </div>
    `;
    div.classList.add("participant-line");
    container.appendChild(div);
  });
}

    function excluirParticipante(index) {
      participantes.splice(index, 1);
      localStorage.setItem('participantes', JSON.stringify(participantes));
      renderizarParticipantes();
    }

    function editarParticipante(event, token) {
  event.preventDefault();
  event.stopPropagation();

  const participant = participantes.find(p => p.token === token);
  if (!participant) return;

  document.getElementById('editId').value = participant.id;
  document.getElementById('editNome').value = participant.nome;
  document.getElementById('editCPF').value = participant.cpf;
  document.getElementById('editCondom√≠nio').value = participant.condominio;
  document.getElementById('editDesconto').value = participant.desconto || '';

  document.getElementById('editTokenDisplay').innerHTML = `
  <strong>Token:</strong>
  <a href="${participant.link}" target="_blank">${participant.token}</a>
  <button class="btn" onclick="copiarLinkWhatsApp('${participant.link}')">Copiar Link</button>
`;

  abrirPopup('editPopup');
}
    function salvarParticipante() {
  const nome = document.getElementById('nome').value;
  const cpf = document.getElementById('cpf').value;
  const cond = document.getElementById('condominio').value;
  const desc = document.getElementById('desconto').value;
  const token = gerarToken(nome);
  const linkLongo = criarLinkWhatsApp(nome);
  const id = Date.now().toString();

  encurtarLink(linkLongo).then(linkCurto => {
    participantes.push({
      id,
      nome,
      cpf,
      condominio: cond,
      desconto: desc,
      token,
      link: linkCurto,
      cliques: 0,
      timeline: []
    });

    localStorage.setItem('participantes', JSON.stringify(participantes));
    fecharPopup('popup');
    renderizarParticipantes();
  }).catch((error) => {
    alert("Erro ao encurtar o link. Salvando com link original.");
    participantes.push({
      id,
      nome,
      cpf,
      condominio: cond,
      desconto: desc,
      token,
      link: linkLongo,
      cliques: 0,
      timeline: []
    });

    localStorage.setItem('participantes', JSON.stringify(participantes));
    fecharPopup('popup');
    renderizarParticipantes();
  });
}
    function abrirTimeline(token) {
  tokenSelecionado = token;
  const p = participantes.find(x => x.token === token);

  document.getElementById('timelineTitulo').innerText = `Timeline - ${p.nome}`;

  // ‚úÖ Preencher os dados pessoais salvos no momento do cadastro
  const dadosDiv = document.getElementById('timelineDados');
  dadosDiv.innerHTML = `
    <strong>Nome:</strong> ${p.nome}<br>
    <strong>CPF:</strong> ${p.cpf || '---'}<br>
    <strong>Condom√≠nio:</strong> ${p.condominio || '---'}<br>
    <strong>Desconto:</strong> ${p.desconto || '---'}<br>
  `;

  // Timeline
  const conteudo = document.getElementById('timelineConteudo');
  conteudo.innerHTML = '';
  (p.timeline || []).forEach((t, i) => {
    const div = document.createElement('div');
    div.className = 'timeline-entry';
    div.innerText = `${t.nomeCliente} | ${t.condominio} | R$50 Pix`;
    conteudo.appendChild(div);
  });

  document.getElementById('timelinePopup').style.display = 'flex';
}

    function salvarAtivacao() {
      const nomeCli = document.getElementById('cliNome').value;
      const cond = document.getElementById('cliCond').value;
      const p = participantes.find(x => x.token === tokenSelecionado);
      p.timeline.push({ nomeCliente: nomeCli, condominio: cond });
      localStorage.setItem('participantes', JSON.stringify(participantes));
      abrirTimeline(tokenSelecionado);
    }

    function openEditPopup(participantId) {
  const participant = participantes.find(p => p.id === participantId);
  if (!participant) return;

  document.getElementById("editId").value = participant.id;
  document.getElementById("editNome").value = participant.nome;
  document.getElementById("editCPF").value = participant.cpf;
  document.getElementById("editCondom√≠nio").value = participant.condominio;
  document.getElementById("editDesconto").value = participant.desconto;

  const tokenHTML = `
  <strong>Token:</strong>
  <a href="${participant.link}" target="_blank">${participant.token}</a>
  <button onclick="copiarToken('${participant.link}')">Copiar</button>
`;
  document.getElementById("editTokenDisplay").innerHTML = tokenHTML;

  document.getElementById("editPopup").style.display = "flex";
}
    function salvarEdicao() {
  const editId = document.getElementById('editId').value;
  const p = participantes.find(x => x.id === editId);
  if (!p) return;

  p.nome = document.getElementById('editNome').value;
  p.cpf = document.getElementById('editCPF').value;
  p.condominio = document.getElementById('editCondom√≠nio').value;
  p.desconto = document.getElementById('editDesconto').value;
  p.link = criarLinkWhatsApp(p.nome); // Gera novo link, se necess√°rio

  localStorage.setItem('participantes', JSON.stringify(participantes));
  fecharPopup('editPopup');
  renderizarParticipantes(); // Recria a tabela ou lista
    }

    function abrirPopup(id) {
  document.getElementById(id).style.display = 'flex';
}

function fecharPopup(id) {
  document.getElementById(id).style.display = 'none';
}
    function confirmarExclusao(index) {
  const confirmar = confirm("Tem certeza que deseja excluir este participante?");
  if (confirmar) {
    excluirParticipante(index);
  }
}
    function ocultarImagem() {
      document.getElementById('imagem-container').style.display = 'none';
       
}
 function copiarTokenLink(link) {
  navigator.clipboard.writeText(link).then(() => {
    alert("Link copiado com sucesso!");
  }).catch(() => {
    alert("Erro ao copiar o link.");
  });
}

function copiarLinkWhatsApp(link) {
  navigator.clipboard.writeText(link)
    .then(() => alert('Link copiado com sucesso!'))
    .catch(() => alert('Erro ao copiar o link.'));
}

async function encurtarLink(linkOriginal) {
  const response = await fetch("https://api-ssl.bitly.com/v4/shorten", {
    method: "POST",
    headers: {
      "Authorization": "Bearer 85277bf64e124c93115efca1ff2024615d20d51c",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      long_url: linkOriginal,
      domain: "bit.ly"
    })
  });

  if (!response.ok) {
    console.error("Erro ao encurtar link:", await response.text());
    return linkOriginal; // retorna o link original se der erro
  }

  const data = await response.json();
  return data.link;
}

function contabilizarClique(token) {
  const p = participantes.find(x => x.token === token);
  if (!p) return;
  p.cliques = (p.cliques || 0) + 1;
  localStorage.setItem('participantes', JSON.stringify(participantes));
}

function handleCliqueLink(token, link) {
  const p = participantes.find(x => x.token === token);
  if (!p) return;

  p.cliques = (p.cliques || 0) + 1;
  localStorage.setItem('participantes', JSON.stringify(participantes));
  renderizarParticipantes(); // Atualiza o contador na tela

  // Abre o link ap√≥s contar
  window.open(link, '_blank');
}

function criarLinkLandingPage(participante) {
  const nomeCodificado = encodeURIComponent(participante.nome);
  return `https://tracepromotion.github.io/indicacaotracecom/?token=${participante.token}&nome=${nomeCodificado}`;
}
    renderizarParticipantes();
  </script>
</body>

</html>